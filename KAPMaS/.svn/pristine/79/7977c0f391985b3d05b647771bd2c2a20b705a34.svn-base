<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Pro-Mapper">
	
	<select id="getProMemberList" resultType="proEmp">
	 	select 
        a.EMP_ID as empId
        ,a.DEP_CODE as depCode
        ,a.RNK_CODE as rnkCode
        ,a.EMP_PWD as empPwd
        ,a.EMP_NAME as empName
        ,a.EMP_EMAIL as empEmail
        ,a.EMP_PHONE as empPhone
        ,a.EMP_ADD as empAdd
        ,a.EMP_ENABLED as empEnabled
        ,a.EMP_AUTH as empAuth
        ,a.EMP_IMG as empImg
        ,b.EMP_ID as pjmId
        ,b.P_CODE as pCode
        ,b.PM_AUTHORITY as pmAuthority
        from EMPLOYEE a ,PJMEMBER b
        where a.emp_id=b.emp_id
        and b.P_CODE=#{pCode}
	</select>
	
	
	<select id="getListProById" parameterType="str" resultType="propjm">
		select 
		B.P_CODE pCode
		,A.P_NAME pName
		,A.P_ENDDATE pEnddate
		,A.P_STARTDATE pStartdate
		,B.PM_AUTHORITY pmAuthority
		from PROJECT A,PJMEMBER B
		where A.P_CODE = B.P_CODE
        AND B.EMP_ID=#{empId}
        AND A.P_ENABLED=1
	</select>
	
	<select id="getListDoProById" parameterType="str" resultType="pro">
		select 
		A.P_CODE pCode
		,A.P_NAME pName
		,A.P_TITLE pTitle
		,A.P_SUMMARY pSummary
		,A.P_CONTENT pContent
		,A.P_STARTDATE pStartdate
		,A.P_ENDDATE pEnddate
		,A.P_ENABLED pEnabled
		,A.P_STATUS pStatus
		from PROJECT A,PJMEMBER B
		where A.P_CODE = B.P_CODE
        AND B.EMP_ID=#{empId}
        AND NOT(B.PM_AUTHORITY = 'a')
        AND A.P_ENABLED=1
	</select>
			
	<select id="getListAopProById" parameterType="str" resultType="pro">
        select 
     	A.P_CODE pCode            
		,A.P_NAME pName           
		,A.P_TITLE pTitle         
		,A.P_SUMMARY pSummary     
		,A.P_CONTENT pContent     
		,A.P_STARTDATE pStartdate 
		,A.P_ENDDATE pEnddate     
		,A.P_ENABLED pEnabled     
		,A.P_STATUS pStatus       
		from PROJECT A,PJMEMBER B
		where A.P_CODE = B.P_CODE
        AND B.EMP_ID=#{empId}
        AND B.PM_AUTHORITY = 'a'
	</select>
	
	<select id="getListNotProById" parameterType="str" resultType="pro">
   		select 
   		A.P_CODE pCode            
		,A.P_NAME pName           
		,A.P_TITLE pTitle         
		,A.P_SUMMARY pSummary     
		,A.P_CONTENT pContent     
		,A.P_STARTDATE pStartdate 
		,A.P_ENDDATE pEnddate     
		,A.P_ENABLED pEnabled     
		,A.P_STATUS pStatus       
		from PROJECT A,PJMEMBER B
		where A.P_CODE = B.P_CODE
        AND B.EMP_ID=#{empId}
        AND NOT(B.PM_AUTHORITY = 'a')
        AND A.P_ENABLED=0
	</select>
	
	<update id="insertProject" parameterType="pro">
		
		insert into
		PROJECT(P_CODE,P_NAME,P_TITLE,P_SUMMARY,P_CONTENT,P_STARTDATE,P_ENDDATE,P_ENABLED)
		values(concat('p',PROJECT_SEQ.NEXTVAL),#{pName},#{pTitle},#{pSummary},#{pContent},#{pStartdate},#{pEnddate},1)
		
	</update>
	
	
	<update id="updateProject" parameterType="pro">
		update PROJECT 
		set 
		P_NAME=#{pName},P_TITLE=#{pTitle},P_SUMMARY=#{pSummary},P_CONTENT=#{pContent}
		where P_CODE=#{pCode}
	</update>
	
	<update id="updateProjectEnabled" >
		update PROJECT 
		set P_ENABLED=0
		where P_CODE=#{pCode}
	</update>
	
	<update id="onProjectEnabled" >
		update PROJECT 
		set P_ENABLED=1
		where P_CODE=#{pCode}
	</update>
	

	<update id="insertPjmember" parameterType="pjm">
		
		insert into
		PJMEMBER(EMP_ID,P_CODE,PM_AUTHORITY)
		values(#{empId},#{pCode},'PL')
		
	</update>
	
	
	
	<select id="getPcode" resultType="str">
		select max(substr(P_CODE,1))
    	from PROJECT
	</select>

	
	<select id="getProInfo" resultType="pro">
		select * 
		from PROJECT
		where P_CODE = #{pCode}
	
	</select>

	
	<update id="insertPjm" parameterType="pjm">
		
		insert into
		PJMEMBER(EMP_ID,P_CODE,PM_AUTHORITY)
		values(#{empId},#{pCode},'NONE')
		
	</update>
	
	
</mapper>
















