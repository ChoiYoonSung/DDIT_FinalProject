<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page trimDirectiveWhitespaces="true" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>


<head>
	<style type="text/css">
	body{
		background-color: white;
		padding: 50px;
	}
	
	h1 {
		text-align: center;
	
	}	
	.pds-wrapper{
	margin: 0 auto;
	width:50%;
}
	</style>

</head>



<body>
	<h1><u>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;프로젝트&nbsp;&nbsp;초대&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</u></h1>
	<form action="<%=request.getContextPath() %>/mypage/projecterRegist.do" method="post" enctype="multipart/form-data" name="sendForm">
	<br><br>
	<span style="font-size:xx-large;"> 받는 사람|</span> 
	<div  style="margin: 0 auto;width:210px; ">
	<select style="width:150px; float: left;" name="dep" id="dep" class="form-select">
			<option value="">-부서 선택-</option>
			<c:forEach items="${depList }" var="dep" >
				<option value="${dep.depCode }">${dep.depName }</option>
			</c:forEach>
			
	</select>	
	<button type="button" class="btn btn-yellow me-1 mb-1" style="float: left;" onclick="getList();">검색</button>
	</div>
	<br><br><br>
		<div class="pds-wrapper">
		  <table class="table">
		  <thead>
			<tr>
				<th>직급</th>
				<th>이름</th>
				<th>선택</th>
			</tr>
		</thead>
			<tbody id="depList"></tbody>		
		  </table>
	</div>
	<span style="font-size:large;" >&nbsp;&nbsp;&nbsp;받는 사람 목록 : <u id="addList"></u></span> 
	<br><br>
	<div class="mb-3" style="margin: 0 auto;width:50%;">
	<input class="form-control" hidden="" type="text" id="paTitle" name="title" placeholder="" value="${pro.pName }의 프로젝트 초대">
	</div>
	<div class="mb-3" style="margin: 0 auto;width:50%;">
	<textarea class="form-control"  hidden="" rows="15" name="content">
	
	<div style="margin: 0 auto;width:24%;">
	<button type="button" class="btn btn-gray me-1 mb-1" 
		style="float: left;"  onclick="Close();">&nbsp;&nbsp;&nbsp;거 &nbsp;&nbsp;절&nbsp;&nbsp;&nbsp;</button>
	<button type="button"  class="btn btn-yellow me-1 mb-1"
		style="float: left;"  onclick="projecterIn('${pCode}');">&nbsp;&nbsp;&nbsp;승&nbsp;&nbsp;인&nbsp;&nbsp;&nbsp;</button>
	</div>
	
	
	</textarea>
	</div>
	<br><br>
	<div style="margin: 0 auto;width:24%;">
	<button type="button" class="btn btn-gray me-1 mb-1" 
		style="float: left;"  onclick="CloseWindow();">&nbsp;&nbsp;&nbsp;취 &nbsp;&nbsp;소&nbsp;&nbsp;&nbsp;</button>
	<button type="button"  class="btn btn-yellow me-1 mb-1"
		style="float: left;"  onclick="send();">&nbsp;&nbsp;&nbsp;보&nbsp;&nbsp;내&nbsp;&nbsp;기&nbsp;&nbsp;&nbsp;</button>
	</div>
	<input hidden="" value="" id="empList" name="empList">
	</form>
	<script type="text/javascript">
	
	function getList(){
		
		var depCode = $("#dep option:selected").val();
		
		var data = {
				"depCode":depCode
		}
			
		$.ajax({
			url : "<%=request.getContextPath() %>/mypage/getList",
			type : "post",
			data : JSON.stringify(data),
			contentType:"application/json;charset=utf-8",
			success:function(data){
				
				var html="";
				
				for(var i = 0 ; i < data.depEmpList.length;i++){
					html += '<tr>';
					html += '<td>'+data.depEmpList[i].rnkName+'</td>';
					html += '<td>'+data.depEmpList[i].empName+'</td>';
					html += '<td><a href="javascript:addEmp(&#39;'+data.depEmpList[i].empId+'&#39;&#44;&#39;'+data.depEmpList[i].empName+'&#39;);" class="btn btn-info btn-icon btn-circle btn-sm"><i class="fab fa-twitter"></i></a></td>';
					html += '</tr>';
					
				}
				
				$("#depList").empty();
				$("#depList").append(html);
			
			},
			
			error:function(error){
				alert(error.status);
			}
			
		});
		
	}
	
	
		function addEmp(empId,empName){
			
			if($("#"+empId).val() == undefined){
			
			var html="";
			html += '<span id='+empId+' class="empId" value='+empId+'>';
			html += ''+empName+'';
			html += '<a href="javascript:remove(&#39;'+empId+'&#39;);" class="btn btn-danger btn-icon btn-circle btn-sm"><i class="fa fa-times"></i></a>'
			html += '</span>';
			$("#addList").append(html);
				
			return;
			}
			
			alert("이미 추가하였습니다");	
		
		}
		
		
		
		function remove(empId){
			
			
			$("#"+empId).remove();
			
		}
		
		
		function send(){
			var html='';
			var len = $(".empId").length;
			for(var i = 0; i < len; i++){
				$(".empId")[i].innerHTML='';
			}
		
			if(len == 1){
				 var id= $(".empId");
				html += ''+id.attr('id')+'';
				$('#empList').val(html);   
			}else {
			
			for(var i = 0; i < len; i++){
				
				 var id= $(".empId").eq(i);
				 if(i == 0 ){
				 html += ''+id.attr('id')+'';
				 continue;
				 }
				 
				 html += ',';
				 html += ''+id.attr('id')+'';
				 
				  $('#empList').val(html);   
			}
			
			}
			document.sendForm.submit();
			
			
		}
	
	</script>
	
	
	
</body>
